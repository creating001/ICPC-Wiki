### 错位排列

-   前面 $n-1$ 个信封全部装错；
-   前面 $n-1$ 个信封有一个没有装错其余全部装错。

对于第一种情况，前面 $n-1$ 个信封全部装错：因为前面 $n-1$ 个已经全部装错了，所以第 $n$ 封只需要与前面任一一个位置交换即可。

对于第二种情况，前面 $n-1$ 个信封有一个没有装错其余全部装错：考虑这种情况的目的在于，若 $n-1$ 个信封中如果有一个没装错，那么把那个没装错的与 $n$ 交换即可。

其他情况，不可能通过一次操作来把它变成一个长度为 $n$ 的错排。

$$
D_n=(n-1)(D_{n-1}+D_{n-2})
$$

$$
D_n=nD_{n-1}+{(-1)}^n
$$

$$
D_n=\left\lfloor\frac{n!}{\mathrm{e}}\right\rfloor
$$

$$
P=\lim_{n\to\infty}\frac{D_n}{n!}=\frac{1}{\mathrm{e}}
$$
